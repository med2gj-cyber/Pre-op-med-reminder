<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding-top: 50px; }
        .container { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 300px; }
        .med-box { background: #e7f3ff; padding: 10px; border-radius: 10px; margin: 20px 0; }
        button { background: #28a745; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üìå ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤</h2>
        <div class="med-box">
            <p>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</b></p>
            <p>‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° 2 ‡πÇ‡∏ó‡∏£ 02-849-6600 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤</b></p>
            <p>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤: <b id="displayMed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</b></p>
            <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏∏‡∏î: <b id="displayDate">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</b></p>
        </div>
        <button onclick="generateICS()">üìÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
    </div>

    <script>
        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL
        const params = new URLSearchParams(window.location.search);
        const med = params.get('m') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤";
        const dateRaw = params.get('d') || "";

        document.getElementById('displayMed').innerText = med;
        
        if (dateRaw && dateRaw.length === 8) {
            const formatted = dateRaw.substring(6,8) + "/" + dateRaw.substring(4,6) + "/" + dateRaw.substring(0,4);
            document.getElementById('displayDate').innerText = formatted;
        } else {
            document.getElementById('displayDate').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà";
        }

       function generateICS() {
    if(!dateRaw) { alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà!"); return; }
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° 07:00 ‡∏ô. ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö 08:00 ‡∏ô. (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYYMMDDTHHMMSS)
    // ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå ICS ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏≤‡∏Å‡∏• ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ
    const startTime = dateRaw + "T070000"; 
    const endTime = dateRaw + "T080000";

    const icsMsg = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "BEGIN:VEVENT",
        "SUMMARY:‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ " + med + " (07.00 ‡∏ô.)",
        "DTSTART:" + startTime,
        "DTEND:" + endTime,
        "DESCRIPTION:‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ " + med + " ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á",
        "BEGIN:VALARM",
        "TRIGGER:-PT0M", // ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (07.00 ‡∏ô.)
        "ACTION:DISPLAY",
        "DESCRIPTION:Reminder",
        "END:VALARM",
        "END:VEVENT",
        "END:VCALENDAR"
    ].join("\n");

    const blob = new Blob([icsMsg], { type: 'text/calendar;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', 'med-alert.ics');
    link.click();
}
    </script>
</body>
</html>